# AGENTS.md - Personal Blog (howinator.io)

## Overview

Hugo static site blog deployed to https://howinator.io/. Hugo site files live in `site/`. Theme is `timberline`.

## Key Files

- `site/config.toml` — Hugo site configuration (title, menus, social links, permalink structure)
- `site/archetypes/default.md` — Template used by `hugo new` to scaffold new posts
- `site/content/blog/` — All blog posts (flat directory, no date-based subdirectories)
- `site/themes/timberline/` — Active theme
- `site/static/` — Static assets (images in `site/static/img/`, PDFs, manifest)
- `Containerfile` — Podman container build (multi-stage: Hugo build + nginx)
- `site/public/` — Build output (generated by running `hugo`)
- `VIBES.md` — Visual identity and design language guide (color palette, typography, animations, component styles)

## Blog Post Format

Posts live in `site/content/blog/<slug>.md` with YAML frontmatter:

```yaml
---
title: "Post Title Here"
date: 2026-02-07T10:00:00-06:00
draft: true
slug: "post-slug"
categories: ['category1']
tags: ['tag1', 'tag2']
---

Markdown content here.
```

- **Filename**: kebab-case, e.g. `my-new-post.md`
- **Date**: ISO 8601 with timezone offset (author is in US Central, -06:00 CST / -05:00 CDT)
- **Permalink pattern**: `/:year/:month/:day/:slug` (defined in config.toml)
- **Emoji**: Enabled site-wide (`:sunglasses:` etc.)

## Creating a New Post

```bash
hugo new -s site content/blog/my-post-slug.md
```

This scaffolds from `site/archetypes/default.md`. Then edit the generated file to set `title`, `categories`, `tags`, and write content. Set `draft: false` when ready to publish.

## Building & Previewing

```bash
hugo server -s site -D    # Local dev server (includes drafts)
hugo server -s site       # Local dev server (published posts only)
hugo -s site              # Build static site into site/public/
```

The full local dev stack (blog + cc-live + Traefik) is available at `http://localhost:8004` via `make dev`.

## Container Build & Deploy

Uses Podman for builds and a Zot registry. Managed via Makefile:

```bash
make build            # Build blog image
make push             # Build + push blog
make deploy           # Build + push blog + pulumi up

make build-cc-live    # Build cc-live image
make deploy-cc-live   # Build + push cc-live + pulumi up

make deploy-all       # Deploy blog + cc-live together

make dev              # Local dev stack (docker compose) → http://localhost:8004
make dev-heartbeat    # Test heartbeat locally
make dev-down         # Tear down local stack
```

- **Registry**: `zot.ui.sparky.best/{personal-blog,cc-live}`
- **Platform**: `linux/amd64`
- **Infra**: Pulumi IaC in `~/projects/homeserver`

## Live Status System (cc-live)

Go WebSocket sidecar that shows a live status dot in the nav when a Claude Code session is active. See `services/cc-live/AGENTS.md` for full details.

**Components:**
- `services/cc-live/` — Go WebSocket service (server-side)
- `scripts/cc-live/` — Heartbeat daemon scripts (client-side, triggered by Claude Code hooks)
- `site/assets/js/live-status.js` — Browser WebSocket client (~30 lines)
- `site/layouts/shortcodes/cc-status-dot.html` — Inline status dot shortcode

**Claude Code hooks** (`~/.claude/settings.json`):
- `SessionStart` → `cc-live-daemon register` (registers session, starts daemon)
- `SessionEnd` → `cc-live-daemon unregister` (removes session, stops daemon if none left)

**Daemon Makefile targets:**
- `make build-daemon` — compile daemon binary to `~/.cc-live/`
- `make restart-daemon` — build + kill old daemon (auto-restarts on next hook)
- `make reset-daemon` — build + kill + wipe SQLite DB + rotate logs
- `make sync` — build daemon + run sync (reparse all transcripts → SQLite → JSON)

**Sensitive sessions:** Start with `CC_LIVE_SENSITIVE=1 claude` to redact prompts. The live dot and metrics still work, but the displayed prompt is replaced with random noise of the same length. Redaction happens in the daemon before the heartbeat is sent — the real prompt never leaves the laptop. Per-session flag stored in SQLite, so concurrent sessions can mix sensitive and normal.

**Debugging:** See `services/cc-live/debugging.md` for known issues (SQLITE_BUSY on hooks, zombie sessions, scientific notation, typewriter replay).

## Claude Code Session Stats

Session stats are managed by the cc-live daemon's `sync` subcommand. `cc-live-daemon sync` reparses all transcripts from `~/.claude/projects/` into the `session_stats` SQLite table, generates LLM summaries via the Anthropic API, and exports `site/data/cc_sessions.json` for Hugo. The `make build` target runs `make sync` automatically before the container build. During live sessions, the daemon also persists metrics and generates summaries in real-time.
